<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechZen Marketplace</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
/* TechZen Enhanced Marketplace Styles - Modern E-commerce Look */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Roboto', sans-serif;
}

:root {
    --primary-color: #2563eb;
    --primary-dark: #1d4ed8;
    --primary-light: #60a5fa;
    --secondary-color: #10b981;
    --accent-color: #8b5cf6;
    --dark-bg: #1e293b;
    --light-bg: #f8fafc;
    --text-dark: #1e293b;
    --text-light: #64748b;
    --text-white: #f8fafc;
    --border-color: #e2e8f0;
    --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --success: #22c55e;
    --warning: #f59e0b;
    --error: #ef4444;
    --info: #3b82f6;
}

body {
    font-family: 'Segoe UI', 'Roboto', sans-serif;
    line-height: 1.6;
    color: var(--text-dark);
    background-color: #f0f2f5;
}

.container {
    max-width: 1320px;
    margin: 0 auto;
    padding: 0 20px;
}

/* Header */
header {
    background-color: var(--primary-color);
    color: var(--text-white);
    padding: 16px 0;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo h1 {
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    font-weight: 700;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.logo i {
    margin-right: 8px;
    color: white;
    font-size: 24px;
}

.search-bar {
    display: flex;
    flex: 1;
    max-width: 500px;
    margin: 0 24px;
    position: relative;
}

.search-bar input {
    width: 100%;
    padding: 12px 16px;
    border: none;
    border-radius: 4px 0 0 4px;
    font-size: 15px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
}

.search-bar button {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 0 20px;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s ease;
}

.search-bar button:hover {
    background-color: #0d9868;
}

.nav-links {
    display: flex;
    list-style: none;
}

.nav-links li {
    margin-left: 24px;
}

.nav-links a {
    color: var(--text-white);
    text-decoration: none;
    transition: all 0.2s;
    font-weight: 500;
    font-size: 15px;
    display: flex;
    align-items: center;
    position: relative;
}

.nav-links a i {
    margin-right: 5px;
    font-size: 18px;
}

#cart-count {
    position: absolute;
    top: -8px;
    right: -10px;
    background-color: var(--secondary-color);
    color: white;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nav-links a:hover,
.nav-links a.active {
    color: var(--primary-light);
}

.mobile-menu-btn {
    display: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: white;
}

/* Main Content */
main {
    padding: 30px 0 50px;
    min-height: calc(100vh - 250px);
}

section {
    margin-bottom: 40px;
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

section.active {
    display: block;
}

h2 {
    margin-bottom: 24px;
    color: var(--primary-color);
    font-weight: 600;
    font-size: 24px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
}

/* Buttons */
.btn-primary {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
    font-size: 15px;
    display: inline-block;
    text-align: center;
}

.btn-primary:hover {
    background-color: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.btn-primary:active {
    transform: translateY(0);
}

.btn-secondary {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
}

.btn-secondary:hover {
    background-color: #0d9868;
}

/* Products Grid */
.products-section {
    display: block;
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 24px;
}

.product-card {
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    transition: all 0.3s;
    height: 100%;
    display: flex;
    flex-direction: column;
    border: 1px solid #eee;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--hover-shadow);
}

.product-image {
    width: 100%;
    height: 200px;
    object-fit:cover;
    background-color: #f9f9f9;
    padding: 15px;
    transition: transform 0.3s;
}

.product-card:hover .product-image {
    transform: scale(1.03);
}

.product-info {
    padding: 16px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.product-name {
    font-size: 16px;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-dark);
    line-height: 1.3;
    height: 42px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.product-price {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 8px;
    font-size: 18px;
}

.product-meta {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: var(--text-light);
    margin-bottom: 16px;
}

.product-meta span {
    text-transform: capitalize;
    background-color: #f0f2f5;
    padding: 3px 8px;
    border-radius: 4px;
}

.product-card button {
    width: 100%;
    margin-top: auto;
}


/* Add to your existing CSS */
.seller-product-item {
    display: flex;
    align-items: center;
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 4px;
}

.delete-product-btn {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.delete-product-btn:hover {
    background-color: #c0392b;
}

/* Filters Section */
.filters-section {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    margin-bottom: 30px;
}

.filter-group {
    margin-bottom: 20px;
}

.filter-group h3 {
    font-size: 16px;
    margin-bottom: 12px;
    font-weight: 500;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.filter-options label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
}

.filter-options input[type="checkbox"] {
    margin-right: 8px;
    width: 16px;
    height: 16px;
    accent-color: var(--primary-color);
}

.price-slider {
    margin: 20px 0;
}

.price-values {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-size: 14px;
    color: var(--text-light);
}

.filters-section button {
    margin-right: 10px;
}

/* Auth Section */
.auth-container {
    max-width: 500px;
    margin: 0 auto;
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    overflow: hidden;
}

.auth-tabs {
    display: flex;
    border-bottom: 1px solid var(--border-color);
}

.auth-tab {
    flex: 1;
    padding: 16px;
    text-align: center;
    background-color: #f8fafc;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
}

.auth-tab.active {
    background-color: white;
    border-bottom: 2px solid var(--primary-color);
    color: var(--primary-color);
}

.auth-form {
    padding: 30px;
    display: none;
}

.auth-form.active {
    display: block;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 14px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 15px;
    transition: border-color 0.2s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-row {
    display: flex;
    gap: 20px;
}

.form-row .form-group {
    flex: 1;
}

.radio-group {
    display: flex;
    gap: 20px;
}

.radio-group label {
    display: flex;
    align-items: center;
    margin-bottom: 0;
    cursor: pointer;
}

.radio-group input {
    width: auto;
    margin-right: 8px;
    accent-color: var(--primary-color);
}

/* Cart Section */
.cart-items {
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    margin-bottom: 24px;
    overflow: hidden;
}

.empty-cart-message {
    padding: 40px;
    text-align: center;
    color: var(--text-light);
    font-size: 18px;
}

.cart-item {
    display: flex;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    align-items: center;
}

.cart-item-image {
    width: 100px;
    height: 100px;
    object-fit: contain;
    margin-right: 20px;
    background-color: #f9f9f9;
    padding: 5px;
    border-radius: 4px;
}

.cart-item-details {
    flex: 1;
}

.cart-item-details h3 {
    font-size: 16px;
    margin-bottom: 8px;
}

.cart-item-details p {
    color: var(--text-light);
    margin-bottom: 4px;
}

.cart-item-details strong {
    color: var(--primary-color);
}

.cart-item-actions {
    display: flex;
    align-items: center;
    gap: 12px;
}

.cart-item-actions button {
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 14px;
}

.remove-item {
    background-color: var(--error) !important;
}

.remove-item:hover {
    background-color: #dc2626 !important;
}

.cart-summary {
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.cart-total {
    font-size: 18px;
    font-weight: 600;
}

#checkout-btn {
    padding: 12px 24px;
    font-size: 16px;
}

/* Loading Spinner */
.loading-spinner {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1001;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.toast {
    background-color: var(--dark-bg);
    color: white;
    padding: 16px 20px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
    opacity: 0;
    max-width: 350px;
    font-weight: 500;
}

.toast.success {
    background-color: var(--success);
}

.toast.error {
    background-color: var(--error);
}

.toast.warning {
    background-color: var(--warning);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-20px); }
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 1001;
    overflow-y: auto;
}

.modal-content {
    background-color: white;
    margin: 7% auto;
    padding: 30px;
    border-radius: 12px;
    max-width: 650px;
    position: relative;
    animation: modalSlideDown 0.3s;
}

@keyframes modalSlideDown {
    from { transform: translateY(-30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.close-modal {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-light);
    transition: color 0.2s;
}

.close-modal:hover {
    color: var(--text-dark);
}

/* Footer */
footer {
    background-color: var(--dark-bg);
    color: var(--text-white);
    padding: 50px 0 20px;
    margin-top: 50px;
}

.footer-content {
    display: flex;
    flex-wrap: wrap;
    gap: 40px;
    margin-bottom: 40px;
}

.footer-logo {
    flex: 1;
    min-width: 220px;
}

.footer-logo h2 {
    color: white;
    margin-bottom: 12px;
    border-bottom: none;
    padding-bottom: 0;
}

.footer-logo p {
    color: #94a3b8;
}

.footer-links {
    flex: 1;
    min-width: 160px;
}

.footer-links h3,
.footer-newsletter h3 {
    color: white;
    margin-bottom: 16px;
    font-size: 18px;
    font-weight: 500;
}

.footer-links ul {
    list-style: none;
}

.footer-links li {
    margin-bottom: 12px;
}

.footer-links a {
    color: #94a3b8;
    text-decoration: none;
    transition: color 0.2s;
    font-size: 15px;
}

.footer-links a:hover {
    color: var(--primary-light);
}

.footer-newsletter {
    flex: 2;
    min-width: 280px;
}

.footer-newsletter p {
    color: #94a3b8;
    margin-bottom: 12px;
}

.newsletter-form {
    display: flex;
    margin-top: 16px;
}

.newsletter-form input {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 6px 0 0 6px;
    font-size: 15px;
}

.newsletter-form button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 0 6px 6px 0;
    cursor: pointer;
    transition: background-color 0.2s;
}

.newsletter-form button:hover {
    background-color: var(--primary-dark);
}

.footer-bottom {
    text-align: center;
    padding-top: 20px;
    border-top: 1px solid #334155;
    color: #94a3b8;
    font-size: 14px;
}

/* Checkout Section */
.checkout-container {
    display: flex;
    gap: 30px;
}

.checkout-form-container {
    flex: 3;
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    padding: 30px;
}

.checkout-form-container h3 {
    margin-bottom: 20px;
    font-size: 18px;
    color: var(--text-dark);
}

.order-summary {
    flex: 2;
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    padding: 30px;
    height: fit-content;
    position: sticky;
    top: 100px;
}

.order-items {
    margin-bottom: 20px;
    max-height: 300px;
    overflow-y: auto;
    padding-right: 10px;
}

.order-item {
    display: flex;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
}

.order-item-image {
    width: 60px;
    height: 60px;
    object-fit: contain;
    margin-right: 15px;
    background-color: #f9f9f9;
    padding: 5px;
    border-radius: 4px;
}

.order-item-details {
    flex: 1;
}

.order-item-details h4 {
    font-size: 14px;
    margin-bottom: 5px;
}

.order-item-details p {
    font-size: 13px;
    color: var(--text-light);
}

.order-totals {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.order-subtotal,
.order-shipping,
.order-tax {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    color: var(--text-light);
    font-size: 14px;
}

.order-total {
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    font-size: 18px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

.payment-methods {
    margin: 24px 0;
}

.payment-method {
    margin-bottom: 12px;
}

.payment-method label {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.payment-method input {
    margin-right: 10px;
    accent-color: var(--primary-color);
}

.payment-details {
    display: none;
    margin: 15px 0;
    padding: 20px;
    background-color: #f8fafc;
    border-radius: 8px;
    animation: fadeIn 0.3s;
}

/* Orders Section */
.orders-tabs {
    display: flex;
    margin-bottom: 24px;
}

.orders-tab {
    padding: 12px 24px;
    background-color: #f8fafc;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    margin-right: 16px;
    font-weight: 500;
    transition: all 0.2s;
}

.orders-tab.active {
    border-bottom: 2px solid var(--primary-color);
    color: var(--primary-color);
}

.order-card {
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    margin-bottom: 20px;
    padding: 20px;
    transition: transform 0.2s;
}

.order-card:hover {
    transform: translateY(-2px);
}

.order-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.status {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 50px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 5px;
}

.status.processing {
    background-color: #e0f2fe;
    color: #0369a1;
}

.status.shipped {
    background-color: #fef9c3;
    color: #a16207;
}

.status.delivered {
    background-color: #dcfce7;
    color: #15803d;
}

.status.cancelled {
    background-color: #fee2e2;
    color: #b91c1c;
}

.order-products {
    margin: 15px 0;
}

.order-product {
    display: flex;
    margin-bottom: 12px;
    align-items: center;
}

.order-product-image {
    width: 50px;
    height: 50px;
    object-fit: contain;
    margin-right: 15px;
    background-color: #f9f9f9;
    padding: 5px;
    border-radius: 4px;
}

.order-footer {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

/* Order Tracking */
.tracking-timeline {
    margin: 30px 0;
    position: relative;
}

.tracking-step {
    display: flex;
    margin-bottom: 30px;
    position: relative;
}

.tracking-step::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 30px;
    height: calc(100% + 15px);
    width: 2px;
    background-color: #e2e8f0;
    z-index: 0;
}

.tracking-step:last-child::before {
    display: none;
}

.step-icon {
    width: 30px;
    height: 30px;
    background-color: #e2e8f0;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-right: 20px;
    z-index: 1;
    color: var(--text-light);
}

.step-icon.completed {
    background-color: var(--success);
    color: white;
}

.step-icon.current {
    background-color: var(--primary-color);
    color: white;
    box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
}

.step-info {
    flex: 1;
}

.step-info h4 {
    margin-bottom: 5px;
    font-weight: 500;
}

.step-date {
    font-size: 13px;
    color: var(--text-light);
    margin-bottom: 5px;
}

.shipping-details {
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    padding: 24px;
    font-size: 15px;
    line-height: 1.7;
}

.shipping-details h3 {
    margin-bottom: 16px;
    font-size: 18px;
}

/* Product Card Placeholder (Loading) */
.product-card-placeholder {
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    height: 350px;
    position: relative;
}

.product-card-placeholder::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, #f0f0f0 25%, #f8f8f8 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Product Detail */
.product-detail-container {
    display: flex;
    gap: 40px;
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    padding: 30px;
    margin-top: 20px;
}

.product-detail-images {
    flex: 1;
    max-width: 500px;
}

.main-image {
    width: 100%;
    height: 400px;
    object-fit: contain;
    margin-bottom: 20px;
    border-radius: 8px;
    background-color: #f9f9f9;
    padding: 20px;
}

.image-thumbnails {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.image-thumbnail {
    width: 80px;
    height: 80px;
    object-fit: cover;
    cursor: pointer;
    border-radius: 6px;
    border: 2px solid transparent;
    padding: 3px;
    background-color: #f9f9f9;
    transition: all 0.2s;
}

.image-thumbnail.active {
    border-color: var(--primary-color);
}

.product-detail-info {
    flex: 1;
}

.product-detail-name {
    font-size: 28px;
    margin-bottom: 10px;
    font-weight: 600;
}

.product-detail-price {
    font-size: 28px;
    color: var(--primary-color);
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.product-detail-price::before {
    content: "₹";
    font-size: 20px;
    margin-right: 2px;
}

.product-detail-meta {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
}

.meta-item {
    background-color: #f0f7ff;
    padding: 6px 12px;
    border-radius: 50px;
    font-size: 14px;
    color: var(--primary-color);
    display: inline-flex;
    align-items: center;
}

.meta-item::before {
    content: "";
    width: 8px;
    height: 8px;
    background-color: var(--primary-color);
    border-radius: 50%;
    margin-right: 6px;
    display: inline-block;
}

.product-detail-description {
    line-height: 1.8;
    color: var(--text-dark);
    margin-bottom: 30px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border-color);
}

.product-quantity {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
}

.product-quantity span {
    font-weight: 500;
}

.quantity-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f0f2f5;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    user-select: none;
    transition: all 0.2s;
}

.quantity-btn:hover {
    background-color: var(--primary-light);
    color: white;
}

.quantity-input {
    width: 50px;
    height: 32px;
    text-align: center;
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.product-actions {
    display: flex;
    gap: 16px;
    margin-bottom: 32px;
}

.product-actions button {
    flex: 1;
    padding: 14px 20px;
    font-size: 16px;
}

.seller-info {
    background-color: #f9fafb;
    padding: 20px;
    border-radius: 8px;
    margin-top: 30px;
}

.seller-info h3 {
    font-size: 18px;
    margin-bottom: 12px;
    color: var(--text-dark);
}

/* Seller Products Management */
.seller-product-item {
    display: flex;
    align-items: center;
    margin: 15px 0;
    padding: 15px;
    border: 1px solid #eee;
    border-radius: 8px;
    background-color: white;
    transition: transform 0.2s, box-shadow 0.2s;
}

.seller-product-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--card-shadow);
}

.seller-product-item img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    border-radius: 6px;
    margin-right: 15px;
    border: 1px solid #eee;
}
img {
    max-width: 100%;
    height: auto;
    object-fit: cover;
    display: block;
}

.delete-product-btn {
    background-color: #e74c3c !important;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.delete-product-btn:hover {
    background-color: #c0392b !important;
}

/* Rating Stars */
.rating-stars {
    display: flex;
    gap: 5px;
    margin: 10px 0;
    font-size: 30px;
}

.star {
    color: #d1d5db;
    cursor: pointer;
    transition: color 0.2s;
}

.star:hover, .star.selected {
    color: #fbbf24;
}

/* Image Preview in Sell Form */
.image-preview {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.preview-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

/* Product Card Badge */
.product-card .badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: var(--accent-color);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.product-card .badge.new {
    background-color: var(--success);
}

.product-card .badge.sale {
    background-color: var(--error);
}

/* Product Card Actions */
.product-actions-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: rgba(255, 255, 255, 0.9);
    display: flex;
    justify-content: space-around;
    padding: 10px;
    transform: translateY(100%);
    transition: transform 0.3s;
}

.product-card:hover .product-actions-overlay {
    transform: translateY(0);
}

.action-button {
    background: none;
    border: none;
    font-size: 18px;
    color: var(--text-dark);
    cursor: pointer;
    transition: color 0.2s;
}

.action-button:hover {
    color: var(--primary-color);
}

/* Enhanced Checkout */
.checkout-section {
    background-color: #f8fafc;
    padding: 40px 0;
    min-height: 80vh;
}

.checkout-container {
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    gap: 30px;
}

.checkout-form-container {
    background-color: white;
    border-radius: 12px;
    box-shadow: rgba(0, 0, 0, 0.05) 0px 6px 24px;
    padding: 30px;
    position: relative;
}

/* Checkout Progress */
.checkout-progress {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    position: relative;
}

.checkout-progress::before {
    content: "";
    position: absolute;
    top: 15px;
    left: 0;
    right: 0;
    height: 4px;
    background-color: #e5e7eb;
    z-index: 0;
}

.progress-step {
    position: relative;
    z-index: 1;
    text-align: center;
}

.step-icon {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background-color: white;
    border: 4px solid #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    color: var(--text-light);
    transition: all 0.3s;
}

.progress-step.active .step-icon {
    border-color: var(--primary-color);
    background-color: var(--primary-color);
    color: white;
}

.progress-step.completed .step-icon {
    border-color: var(--success);
    background-color: var(--success);
    color: white;
}

.step-label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-light);
}

.progress-step.active .step-label {
    color: var(--primary-color);
}

.progress-step.completed .step-label {
    color: var(--success);
}

/* Order Summary Card */
.order-summary {
    background-color: white;
    border-radius: 12px;
    box-shadow: rgba(0, 0, 0, 0.05) 0px 6px 24px;
    padding: 30px;
    align-self: flex-start;
    position: sticky;
    top: 100px;
}

.order-summary h3 {
    font-size: 20px;
    margin-bottom: 20px;
    position: relative;
    padding-bottom: 15px;
}

.order-summary h3::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 50px;
    height: 3px;
    background-color: var(--primary-color);
}

/* Promo Code */
.promo-code {
    margin: 20px 0;
    padding: 20px 0;
    border-top: 1px dashed var(--border-color);
    border-bottom: 1px dashed var(--border-color);
}

.promo-code-input {
    display: flex;
}

.promo-code-input input {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-right: none;
    border-radius: 4px 0 0 4px;
    font-size: 15px;
}

.promo-code-input button {
    padding: 12px 20px;
    background-color: var(--secondary-color);
    color: white;
    border: none;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
    transition: background-color 0.2s;
}

.promo-code-input button:hover {
    background-color: #0d9868;
}

/* Responsive Media Queries */
@media (max-width: 1200px) {
    .checkout-container {
        grid-template-columns: 1fr;
    }
    
    .order-summary {
        position: static;
    }
}

@media (max-width: 992px) {
    .header-content {
        flex-wrap: wrap;
    }
    
    .search-bar {
        order: 3;
        margin: 15px 0;
        width: 100%;
        max-width: 100%;
    }
    
    .product-detail-container {
        flex-direction: column;
    }
    
    .product-detail-images, .product-detail-info {
        width: 100%;
        max-width: 100%;
    }
}

@media (max-width: 768px) {
    .mobile-menu-btn {
        display: block;
    }
    
    .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: var(--primary-color);
        flex-direction: column;
        padding: 20px;
    }
    
    .nav-links li {
        margin: 10px 0;
    }
    
    .footer-content {
        flex-direction: column;
        gap: 30px;
    }
    
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
}

/* Animation for Product Card */
@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(37, 99, 235, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
    }
}

.product-card:hover button {
    animation: pulse 1.5s infinite;
}

/* Flipkart-inspired Price Display */
.price-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 8px 0;
}

.original-price {
    text-decoration: line-through;
    color: var(--text-light);
    font-size: 14px;
}

.discount-badge {
    background-color: #388e3c;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

/* Amazon-inspired Buy Box */
.buy-box {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    background-color: #f9fafb;
}

.delivery-info {
    margin: 15px 0;
}

.delivery-date {
    font-weight: 600;
    color: var(--success);
}

.stock-status {
    margin: 15px 0;
    font-weight: 500;
}

.in-stock {
    color: var(--success);
}

.low-stock {
    color: var(--warning);
}

.out-of-stock {
    color: var(--error);
}

/* User Profile Improvements */
.profile-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
}

.profile-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: var(--primary-light);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: 600;
}

.profile-info h2 {
    margin-bottom: 5px;
}

.profile-info p {
    color: var(--text-light);
}

.profile-tabs {
    display: flex;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 24px;
}

.profile-tab {
    padding: 12px 24px;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 2px solid transparent;
    font-weight: 500;
}

.profile-tab:hover {
    color: var(--primary-color);
}

.profile-tab.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
}

/* Final touches and refinements */
.btn-primary {
    background-image: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
}

.btn-primary:hover {
    background-image: linear-gradient(to bottom, var(--primary-dark), var(--primary-dark));
}

.search-bar input {
    border: 1px solid #ddd;
}

header {
    background-image: linear-gradient(to right, var(--primary-color), var(--primary-dark));
}

/* Modern shadows for cards */
.product-card, .auth-container, .checkout-form-container, .order-summary {
    box-shadow: rgba(0, 0, 0, 0.05) 0px 6px 24px, rgba(0, 0, 0, 0.08) 0px 0px 0px 1px;
}

    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><i class="fas fa-microchip"></i> TechZen</h1>
                </div>
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="Search products...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <nav>
                    <ul class="nav-links">
                        <li><a href="/home.html" class="active">Home</a></li>
                        <li><a href="#" id="shop-link">Shop</a></li>
                        <li><a href="#" id="sell-link">Sell</a></li>
                        <li><a href="#" id="orders-link">Orders</a></li>
                        <li><a href="#" id="cart-link"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></a></li>
                        <li><a href="#" id="auth-link">Login / Sign Up</a></li>
                    </ul>
                </nav>
                <div class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Filter Section -->
            <section class="filters-section" id="filters-section">
                <h2>Filters</h2>
                <div class="filter-group">
                    <h3>Categories</h3>
                    <div class="filter-options">
                        <label><input type="checkbox" name="category" value="laptops"> Laptops</label>
                        <label><input type="checkbox" name="category" value="smartphones"> Smartphones</label>
                        <label><input type="checkbox" name="category" value="accessories"> Accessories</label>
                        <label><input type="checkbox" name="category" value="components"> Components</label>
                        <label><input type="checkbox" name="category" value="audio"> Audio</label>
                    </div>
                </div>
                <div class="filter-group">
                    <h3>Condition</h3>
                    <div class="filter-options">
                        <label><input type="checkbox" name="condition" value="new"> New</label>
                        <label><input type="checkbox" name="condition" value="like-new"> Like New</label>
                        <label><input type="checkbox" name="condition" value="used"> Used</label>
                        <label><input type="checkbox" name="condition" value="refurbished"> Refurbished</label>
                    </div>
                </div>
                <div class="filter-group">
                    <h3>Price Range</h3>
                    <div class="price-slider">
                        <input type="range" id="min-price" min="0" max="10000" step="100" value="0">
                        <input type="range" id="max-price" min="0" max="10000" step="100" value="10000">
                        <div class="price-values">
                            <span id="min-price-value">0</span> - <span id="max-price-value">10000</span>
                        </div>
                    </div>
                </div>
                <button id="apply-filters">Apply Filters</button>
                <button id="clear-filters">Clear Filters</button>
            </section>

            <!-- Products Grid -->
            <section class="products-section" id="products-section">
                <h2>Featured Products</h2>
                <div class="products-grid" id="products-grid">
                    <!-- Products will be loaded dynamically -->
                    <div class="product-card-placeholder"></div>
                    <div class="product-card-placeholder"></div>
                    <div class="product-card-placeholder"></div>
                    <div class="product-card-placeholder"></div>
                    <div class="product-card-placeholder"></div>
                    <div class="product-card-placeholder"></div>
                </div>
            </section>

            <!-- Authentication Section -->
            <section class="auth-section" id="auth-section">
                <div class="auth-container">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">Login</button>
                        <button class="auth-tab" data-tab="signup">Sign Up</button>
                    </div>
                    <div class="auth-form-container">
                        <!-- Login Form -->
                        <form id="login-form" class="auth-form active">
                            <h2>Login to Your Account</h2>
                            <div class="form-group">
                                <label for="login-email">Email</label>
                                <input type="email" id="login-email" required>
                            </div>
                            <div class="form-group">
                                <label for="login-password">Password</label>
                                <input type="password" id="login-password" required>
                            </div>
                            <button type="submit" class="btn-primary">Login</button>
                        </form>
                        
                        <!-- Sign Up Form -->
                        <form id="signup-form" class="auth-form">
                            <h2>Create an Account</h2>
                            <div class="form-group">
                                <label for="signup-name">Full Name</label>
                                <input type="text" id="signup-name" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-email">Email</label>
                                <input type="email" id="signup-email" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-password">Password</label>
                                <input type="password" id="signup-password" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-confirm-password">Confirm Password</label>
                                <input type="password" id="signup-confirm-password" required>
                            </div>
                            <div class="form-group">
                                <label>Account Type</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="account-type" value="buyer" checked> Buyer</label>
                                    <label><input type="radio" name="account-type" value="seller"> Seller</label>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">Sign Up</button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Sell Product Section -->
            <section class="sell-section" id="sell-section">
                <h2>Sell Your Tech</h2>
                <form id="sell-form">
                    <div class="form-group">
                        <label for="product-name">Product Name</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="product-description">Description</label>
                        <textarea id="product-description" rows="4" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">Category</label>
                            <select id="product-category" required>
                                <option value="">Select Category</option>
                                <option value="laptops">Laptops</option>
                                <option value="smartphones">Smartphones</option>
                                <option value="accessories">Accessories</option>
                                <option value="components">Components</option>
                                <option value="audio">Audio</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="product-condition">Condition</label>
                            <select id="product-condition" required>
                                <option value="">Select Condition</option>
                                <option value="new">New</option>
                                <option value="like-new">Like New</option>
                                <option value="used">Used</option>
                                <option value="refurbished">Refurbished</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-price">Price(Rs.)</label>
                            <input type="number" id="product-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="product-quantity">Quantity</label>
                            <input type="number" id="product-quantity" min="1" value="1" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="product-image">Product Images</label>
                        <input type="file" id="product-image" accept="image/*" multiple>
                        <div id="image-preview" class="image-preview"></div>
                    </div>
                    <button type="submit" class="btn-primary">List Product</button>
                </form>
            </section>

            <!-- Product Detail Section -->
            <section class="product-detail-section" id="product-detail-section">
                <!-- Product details will be loaded dynamically -->
            </section>

            <!-- Cart Section -->
            <section class="cart-section" id="cart-section">
                <h2>Your Cart</h2>
                <div class="cart-items" id="cart-items">
                    <!-- Cart items will be loaded dynamically -->
                </div>
                <div class="cart-summary">
                    <div class="cart-total">
                        <span>Total:</span>
                        <span id="cart-total-amount">$0.00</span>
                    </div>
                    <button id="checkout-btn" class="btn-primary">Proceed to Checkout</button>
                </div>
            </section>

            <!-- Checkout Section -->
            <section class="checkout-section" id="checkout-section">
                <h2>Checkout</h2>
                <div class="checkout-container">
                    <div class="checkout-form-container">
                        <form id="checkout-form">
                            <h3>Shipping Information</h3>
                            <div class="form-group">
                                <label for="shipping-name">Full Name</label>
                                <input type="text" id="shipping-name" required>
                            </div>
                            <div class="form-group">
                                <label for="shipping-address">Address</label>
                                <input type="text" id="shipping-address" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="shipping-city">City</label>
                                    <input type="text" id="shipping-city" required>
                                </div>
                                <div class="form-group">
                                    <label for="shipping-zip">ZIP Code</label>
                                    <input type="text" id="shipping-zip" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="shipping-country">Country</label>
                                <input type="text" id="shipping-country" required>
                            </div>
                            <div class="form-group">
                                <label for="shipping-phone">Phone</label>
                                <input type="tel" id="shipping-phone" required>
                            </div>

                            <h3>Payment Method</h3>
                            <div class="payment-methods">
                                <div class="payment-method">
                                    <input type="radio" id="credit-card" name="payment-method" value="credit-card" checked>
                                    <label for="credit-card">Credit/Debit Card</label>
                                </div>
                                <div class="payment-method">
                                    <input type="radio" id="paypal" name="payment-method" value="paypal">
                                    <label for="paypal">PayPal</label>
                                </div>
                                <div class="payment-method">
                                    <input type="radio" id="upi" name="payment-method" value="upi">
                                    <label for="upi">UPI</label>
                                </div>
                                <div class="payment-method">
                                    <input type="radio" id="crypto" name="payment-method" value="crypto">
                                    <label for="crypto">Cryptocurrency</label>
                                </div>
                            </div>

                            <!-- Credit Card Form -->
                            <div class="payment-details" id="credit-card-details">
                                <div class="form-group">
                                    <label for="card-number">Card Number</label>
                                    <input type="text" id="card-number" placeholder="1234 5678 9012 3456">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="card-expiry">Expiry Date</label>
                                        <input type="text" id="card-expiry" placeholder="MM/YY">
                                    </div>
                                    <div class="form-group">
                                        <label for="card-cvv">CVV</label>
                                        <input type="text" id="card-cvv" placeholder="123">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="card-name">Name on Card</label>
                                    <input type="text" id="card-name">
                                </div>
                            </div>

                            <!-- PayPal Form -->
                            <div class="payment-details" id="paypal-details">
                                <p>You will be redirected to PayPal to complete your payment.</p>
                            </div>

                            <!-- UPI Form -->
                            <div class="payment-details" id="upi-details">
                                <div class="form-group">
                                    <label for="upi-id">UPI ID</label>
                                    <input type="text" id="upi-id" placeholder="example@ybl">
                                </div>
                            </div>

                            <!-- Crypto Form -->
                            <div class="payment-details" id="crypto-details">
                                <div class="form-group">
                                    <label for="crypto-currency">Select Cryptocurrency</label>
                                    <select id="crypto-currency">
                                        <option value="btc">Bitcoin (BTC)</option>
                                        <option value="eth">Ethereum (ETH)</option>
                                        <option value="usdt">Tether (USDT)</option>
                                    </select>
                                </div>
                                <p>Wallet address will be provided on the next step.</p>
                            </div>

                            <button type="submit" class="btn-primary">Place Order</button>
                        </form>
                    </div>
                    <div class="order-summary">
                        <h3>Order Summary</h3>
                        <div class="order-items" id="order-items">
                            <!-- Order items will be loaded dynamically -->
                        </div>
                        <div class="order-totals">
                            <div class="order-subtotal">
                                <span>Subtotal:</span>
                                <span id="order-subtotal">$0.00</span>
                            </div>
                            <div class="order-shipping">
                                <span>Shipping:</span>
                                <span id="order-shipping">$0.00</span>
                            </div>
                            <div class="order-tax">
                                <span>Tax:</span>
                                <span id="order-tax">$0.00</span>
                            </div>
                            <div class="order-total">
                                <span>Total:</span>
                                <span id="order-total">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section class="orders-section" id="orders-section">
                <h2>Your Orders</h2>
                <div class="orders-tabs">
                    <button class="orders-tab active" data-tab="active">Active Orders</button>
                    <button class="orders-tab" data-tab="completed">Completed Orders</button>
                </div>
                <div class="orders-list" id="orders-list">
                    <!-- Orders will be loaded dynamically -->
                </div>
            </section>

            <!-- Order Tracking Section -->
            <section class="order-tracking-section" id="order-tracking-section">
                <h2>Track Your Order</h2>
                <div class="order-details" id="tracking-order-details">
                    <!-- Order details will be loaded dynamically -->
                </div>
                <div class="tracking-status">
                    <div class="tracking-timeline" id="tracking-timeline">
                        <!-- Tracking timeline will be loaded dynamically -->
                    </div>
                </div>
                <div class="shipping-details" id="shipping-details">
                    <!-- Shipping details will be loaded dynamically -->
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2><i class="fas fa-microchip"></i> TechZen</h2>
                    <p>Your one-stop marketplace for tech products</p>
                </div>
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Shop</a></li>
                        <li><a href="#">Sell</a></li>
                        <li><a href="#">My Account</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Shipping Policy</a></li>
                        <li><a href="#">Return Policy</a></li>
                    </ul>
                </div>
                <div class="footer-newsletter">
                    <h3>Stay Updated</h3>
                    <p>Subscribe to our newsletter for the latest products and deals</p>
                    <div class="newsletter-form">
                        <input type="email" placeholder="Your email address">
                        <button>Subscribe</button>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TechZen Marketplace. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
    </div>
    
    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
// Global variables
let currentUser = null;
let cart = [];
let products = [];
let activeSection = 'products-section';

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
    loadCart();
    setupEventListeners();
    navigateTo('products-section');
    fetchProducts();
});

// Setup all event listeners
function setupEventListeners() {
    // Navigation
    document.getElementById('shop-link').addEventListener('click', () => navigateTo('products-section'));
    document.getElementById('sell-link').addEventListener('click', () => {
        if (currentUser) {
            navigateTo('sell-section');
        } else {
            showToast('Please login to sell products', 'warning');
            navigateTo('auth-section');
        }
    });
    document.getElementById('orders-link').addEventListener('click', () => {
        if (currentUser) {
            navigateTo('orders-section');
            fetchOrders();
        } else {
            showToast('Please login to view orders', 'warning');
            navigateTo('auth-section');
        }
    });
// Update this event listener in your setupEventListeners function
document.getElementById('cart-link').addEventListener('click', () => {
    navigateTo('cart-section');
    renderCart(); // Explicitly render the cart when navigating to the cart section
});
    document.getElementById('auth-link').addEventListener('click', () => navigateTo('auth-section'));

    // Search
    document.getElementById('search-btn').addEventListener('click', handleSearch);
    document.getElementById('search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSearch();
    });

    // Filters
    document.getElementById('apply-filters').addEventListener('click', applyFilters);
    document.getElementById('clear-filters').addEventListener('click', clearFilters);
    
    // Auth tabs
    const authTabs = document.querySelectorAll('.auth-tab');
    authTabs.forEach(tab => {
        tab.addEventListener('click', () => switchAuthTab(tab));
    });

    // Auth forms
    document.getElementById('login-form').addEventListener('submit', handleLogin);
    document.getElementById('signup-form').addEventListener('submit', handleSignup);

    // Sell form
    document.getElementById('sell-form').addEventListener('submit', handleProductSubmit);
    document.getElementById('product-image').addEventListener('change', handleImagePreview);

    // Cart
 // Replace the existing checkout button handler code with this:
document.getElementById('checkout-btn').addEventListener('click', () => {
    // First check authentication
    if (!currentUser) {
        showToast('Please login to proceed to checkout', 'warning');
        navigateTo('auth-section');
        return;
    }
    
    // Then check cart
    if (cart.length === 0) {
        showToast('Your cart is empty', 'warning');
        return;
    }
    
    // If both checks pass, proceed to checkout
    navigateTo('checkout-section');
    updateOrderSummary();
});

    // Checkout
    document.getElementById('checkout-form').addEventListener('submit', handleCheckout);
    
    // Payment method selection
    const paymentMethods = document.querySelectorAll('input[name="payment-method"]');
    paymentMethods.forEach(method => {
        method.addEventListener('change', () => {
            document.querySelectorAll('.payment-details').forEach(detail => {
                detail.style.display = 'none';
            });
            document.getElementById(`${method.value}-details`).style.display = 'block';
        });
    });
    
    // Show credit card details by default
    document.getElementById('credit-card-details').style.display = 'block';

    // Orders tabs
    const ordersTabs = document.querySelectorAll('.orders-tab');
    ordersTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            ordersTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            fetchOrders(tab.dataset.tab);
        });
    });

    // Mobile menu
    document.querySelector('.mobile-menu-btn').addEventListener('click', toggleMobileMenu);

    // Modal close
    document.querySelector('.close-modal').addEventListener('click', closeModal);
}

// Navigation
// Update navigateTo function to include auth checking
// First, let's add a filter button to toggle the filters section
function setupFilterToggle() {
    // Add a filters toggle button before the products section
    const filterToggleButton = document.createElement('button');
    filterToggleButton.id = 'filter-toggle-btn';
    filterToggleButton.className = 'btn-primary filter-toggle';
    filterToggleButton.innerHTML = '<i class="fas fa-filter"></i> Show Filters';
    
    // Insert the button before the products section
    const productsSection = document.getElementById('products-section');
    const containerDiv = document.querySelector('main .container');
    containerDiv.insertBefore(filterToggleButton, productsSection);
    
    // Hide the filters section by default
    document.getElementById('filters-section').style.display = 'none';
    
    // Add click event to toggle filters
    filterToggleButton.addEventListener('click', () => {
        const filtersSection = document.getElementById('filters-section');
        if (filtersSection.style.display === 'none' || !filtersSection.style.display) {
            filtersSection.style.display = 'block';
            filterToggleButton.innerHTML = '<i class="fas fa-times"></i> Hide Filters';
            // Add slide down animation
            filtersSection.style.animation = 'slideDown 0.3s ease forwards';
        } else {
            filterToggleButton.innerHTML = '<i class="fas fa-filter"></i> Show Filters';
            // Add slide up animation
            filtersSection.style.animation = 'slideUp 0.3s ease forwards';
            setTimeout(() => {
                filtersSection.style.display = 'none';
            }, 290);
        }
    });
}

// Update the navigateTo function to always hide filters initially except for products section
function navigateTo(sectionId) {
    // Add checkout protection - MUST be at the top
    if (sectionId === 'checkout-section' && !currentUser) {
        showToast('Please login to access checkout', 'warning');
        sectionId = 'auth-section'; // Redirect to auth instead
    }
    
    // Hide all sections
    const sections = document.querySelectorAll('main section');
    sections.forEach(section => {
        section.style.display = 'none';
    });
    
    document.getElementById(sectionId).style.display = 'block';
    activeSection = sectionId;
    
    // If navigating to cart section, render the cart
    if (sectionId === 'cart-section') {
        renderCart();
    }
    
    // If navigating to checkout (and user is authenticated since we checked above), update order summary
    if (sectionId === 'checkout-section') {
        updateOrderSummary();
    }
    
    // Update active link
    const navLinks = document.querySelectorAll('.nav-links a');
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.id === `${sectionId.split('-')[0]}-link`) {
            link.classList.add('active');
        }
    });
    
    // Special case for filters - always hide initially
    document.getElementById('filters-section').style.display = 'none';
    
    // Only show filter toggle button on products section
    const filterToggleBtn = document.getElementById('filter-toggle-btn');
    if (filterToggleBtn) {
        if (sectionId === 'products-section') {
            filterToggleBtn.style.display = 'inline-block';
            filterToggleBtn.innerHTML = '<i class="fas fa-filter"></i> Show Filters';
        } else {
            filterToggleBtn.style.display = 'none';
        }
    }
    
    // Scroll to top
    window.scrollTo(0, 0);
}

// Toggle mobile menu
function toggleMobileMenu() {
    const navLinks = document.querySelector('.nav-links');
    if (navLinks.style.display === 'flex') {
        navLinks.style.display = 'none';
    } else {
        navLinks.style.display = 'flex';
    }
}

// Products
async function fetchProducts(filters = {}) {
    showLoading();
    try {
        let url = '/api/products';
        
        if (Object.keys(filters).length > 0) {
            const params = new URLSearchParams();
            for (const key in filters) {
                if (Array.isArray(filters[key])) {
                    filters[key].forEach(value => {
                        params.append(`${key}[]`, value);
                    });
                } else {
                    params.append(key, filters[key]);
                }
            }
            url += `?${params.toString()}`;
        }
        
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error('Failed to fetch products');
        }
        
        products = await response.json();
        renderProducts(products);
    } catch (error) {
        console.error('Error fetching products:', error);
        showToast('Failed to load products', 'error');
    } finally {
        hideLoading();
    }
}

function renderProducts(productsToRender) {
    const productsGrid = document.getElementById('products-grid');
    productsGrid.innerHTML = '';
    
    if (productsToRender.length === 0) {
        productsGrid.innerHTML = '<p>No products found. Try different filters or search terms.</p>';
        return;
    }
    
    productsToRender.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.innerHTML = `
            <img src="${product.images[0] || '/images/placeholder.jpg'}" alt="${product.name}" class="product-image">
            <div class="product-info">
                <h3 class="product-name">${product.name}</h3>
                <p class="product-price">$${product.price.toFixed(2)}</p>
                <div class="product-meta">
                    <span>${product.condition}</span>
                    <span>${product.category}</span>
                </div>
                <button class="btn-primary view-product" data-id="${product.id}">View Details</button>
            </div>
        `;
        
        productCard.querySelector('.view-product').addEventListener('click', () => viewProductDetail(product.id));
        productsGrid.appendChild(productCard);
    });
}

async function viewProductDetail(productId) {
    showLoading();
    try {
        const response = await fetch(`/api/products/${productId}`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch product details');
        }
        
        const product = await response.json();
        renderProductDetail(product);
        navigateTo('product-detail-section');
    } catch (error) {
        console.error('Error fetching product details:', error);
        showToast('Failed to load product details', 'error');
    } finally {
        hideLoading();
    }
}

function renderProductDetail(product) {
    const detailSection = document.getElementById('product-detail-section');
    
    detailSection.innerHTML = `
        <div class="product-detail-container">
            <div class="product-detail-images">
                <img src="${product.images[0] || '/images/placeholder.jpg'}" alt="${product.name}" class="main-image" id="main-product-image">
                <div class="image-thumbnails">
                    ${product.images.map((img, index) => `
                        <img src="${img}" alt="${product.name}" class="image-thumbnail ${index === 0 ? 'active' : ''}" data-src="${img}">
                    `).join('')}
                </div>
            </div>
            <div class="product-detail-info">
                <h1 class="product-detail-name">${product.name}</h1>
                <p class="product-detail-price">${product.price.toFixed(2)}</p>
                <div class="product-detail-meta">
                    <span class="meta-item">${product.condition}</span>
                    <span class="meta-item">${product.category}</span>
                    <span class="meta-item">Stock: ${product.quantity}</span>
                </div>
                <div class="product-detail-description">
                    ${product.description}
                </div>
                <div class="product-quantity">
                    <span>Quantity:</span>
                    <div class="quantity-btn decrement">-</div>
                    <input type="number" class="quantity-input" value="1" min="1" max="${product.quantity}">
                    <div class="quantity-btn increment">+</div>
                </div>
                <div class="product-actions">
                    <button class="btn-primary" id="add-to-cart-btn">Add to Cart</button>
                </div>
                <div class="seller-info">
                    <h3>Seller Information</h3>
                    <p>Seller: ${product.seller.name}</p>
                    <p>Rating: 4.8/5</p>
                </div>
            </div>
        </div>
    `;
    
    // Setup image gallery
    const thumbnails = detailSection.querySelectorAll('.image-thumbnail');
    const mainImage = detailSection.querySelector('#main-product-image');
    
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', () => {
            thumbnails.forEach(t => t.classList.remove('active'));
            thumbnail.classList.add('active');
            mainImage.src = thumbnail.dataset.src;
        });
    });
    
    // Setup quantity buttons
    const quantityInput = detailSection.querySelector('.quantity-input');
    detailSection.querySelector('.decrement').addEventListener('click', () => {
        if (parseInt(quantityInput.value) > 1) {
            quantityInput.value = parseInt(quantityInput.value) - 1;
        }
    });
    
    detailSection.querySelector('.increment').addEventListener('click', () => {
        if (parseInt(quantityInput.value) < product.quantity) {
            quantityInput.value = parseInt(quantityInput.value) + 1;
        }
    });
    
    // Setup add to cart button
    detailSection.querySelector('#add-to-cart-btn').addEventListener('click', () => {
        const quantity = parseInt(quantityInput.value);
        addToCart(product, quantity);
    });
}

// Search and Filters
function handleSearch() {
    const searchTerm = document.getElementById('search-input').value.trim();
    if (searchTerm) {
        fetchProducts({ search: searchTerm });
    } else {
        fetchProducts();
    }
}

function applyFilters() {
    const filters = {};
    
    // Categories
    const selectedCategories = [...document.querySelectorAll('input[name="category"]:checked')].map(input => input.value);
    if (selectedCategories.length > 0) {
        filters.categories = selectedCategories;
    }
    
    // Conditions
    const selectedConditions = [...document.querySelectorAll('input[name="condition"]:checked')].map(input => input.value);
    if (selectedConditions.length > 0) {
        filters.conditions = selectedConditions;
    }
    
    // Price Range
    const minPrice = document.getElementById('min-price').value;
    const maxPrice = document.getElementById('max-price').value;
    filters.minPrice = minPrice;
    filters.maxPrice = maxPrice;
    
    fetchProducts(filters);
}

function clearFilters() {
    document.querySelectorAll('input[name="category"], input[name="condition"]').forEach(input => {
        input.checked = false;
    });
    
    document.getElementById('min-price').value = 0;
    document.getElementById('max-price').value = 10000;
    document.getElementById('min-price-value').textContent = '$0';
    document.getElementById('max-price-value').textContent = '$10000';
    
    fetchProducts();
}

// Auth
function switchAuthTab(tab) {
    const tabName = tab.dataset.tab;
    
    // Update tab active state
    document.querySelectorAll('.auth-tab').forEach(t => {
        t.classList.remove('active');
    });
    tab.classList.add('active');
    
    // Show corresponding form
    document.querySelectorAll('.auth-form').forEach(form => {
        form.classList.remove('active');
    });
    document.getElementById(`${tabName}-form`).classList.add('active');
}

async function handleLogin(e) {
    e.preventDefault();
    
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
        showToast('Please fill in all fields', 'warning');
        return;
    }
    
    showLoading();
    
    try {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.message || 'Login failed');
        }
        
        // Save user session
        currentUser = data.user;
        sessionStorage.setItem('user', JSON.stringify(currentUser));
        
        // Update UI
        updateAuthUI();
        showToast('Login successful', 'success');
        navigateTo('products-section');
    } catch (error) {
        console.error('Login error:', error);
        showToast(error.message || 'Login failed', 'error');
    } finally {
        hideLoading();
    }
}

async function handleSignup(e) {
    e.preventDefault();
    
    const name = document.getElementById('signup-name').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    const confirmPassword = document.getElementById('signup-confirm-password').value;
    const accountType = document.querySelector('input[name="account-type"]:checked').value;
    
    if (!name || !email || !password) {
        showToast('Please fill in all fields', 'warning');
        return;
    }
    
    if (password !== confirmPassword) {
        showToast('Passwords do not match', 'warning');
        return;
    }
    
    showLoading();
    
    try {
        const response = await fetch('/api/auth/signup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, email, password, accountType })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.message || 'Signup failed');
        }
        
        // Save user session
        currentUser = data.user;
        sessionStorage.setItem('user', JSON.stringify(currentUser));
        
        // Update UI
        updateAuthUI();
        showToast('Account created successfully', 'success');
        navigateTo('products-section');
    } catch (error) {
        console.error('Signup error:', error);
        showToast(error.message || 'Signup failed', 'error');
    } finally {
        hideLoading();
    }
}

function updateAuthUI() {
    const authLink = document.getElementById('auth-link');
    
    if (currentUser) {
        authLink.innerHTML = `<i class="fas fa-user"></i> ${currentUser.name}`;
        authLink.addEventListener('click', showUserMenu);
    } else {
        authLink.innerHTML = 'Login / Sign Up';
        authLink.addEventListener('click', () => navigateTo('auth-section'));
    }
}

// Update the showUserMenu function
function showUserMenu() {
    const modalBody = document.getElementById('modal-body');
    
    let content = `
        <h2>User Account</h2>
        <p>Welcome back, ${currentUser.name}!</p>
        <p>Email: ${currentUser.email}</p>
        <p>Account Type: ${currentUser.accountType}</p>
        <hr>
    `;
    
    // Add seller-specific options if the user is a seller
    if (currentUser.accountType === 'seller') {
        content += `<button id="my-products-btn" class="btn-primary">My Products</button><br><br>`;
    }
    
    content += `<button id="logout-btn" class="btn-primary">Logout</button>`;
    
    modalBody.innerHTML = content;
    
    // Add event listeners
    document.getElementById('logout-btn').addEventListener('click', logout);
    
    if (currentUser.accountType === 'seller') {
        document.getElementById('my-products-btn').addEventListener('click', () => {
            closeModal();
            showSellerProducts();
        });
    }
    
    showModal();
}

// Add this function to fetch and display seller's products
async function showSellerProducts() {
    if (!currentUser || currentUser.accountType !== 'seller') {
        showToast('You need a seller account to access this feature', 'warning');
        return;
    }
    
    showLoading();
    
    try {
        // Fetch all products
        const response = await fetch('/api/products');
        const allProducts = await response.json();
        
        // Filter for this seller's products
        const sellerProducts = allProducts.filter(product => 
            product.seller && product.seller.id === currentUser.id
        );
        
        const modalBody = document.getElementById('modal-body');
        modalBody.innerHTML = `
            <h2>My Products</h2>
            <div id="seller-products-list"></div>
        `;
        
        const productsList = document.getElementById('seller-products-list');
        
        if (sellerProducts.length === 0) {
            productsList.innerHTML = '<p>You haven\'t listed any products yet.</p>';
        } else {
            sellerProducts.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'seller-product-item';
                productItem.style.display = 'flex';
                productItem.style.alignItems = 'center';
                productItem.style.margin = '10px 0';
                productItem.style.padding = '10px';
                productItem.style.border = '1px solid #eee';
                productItem.style.borderRadius = '4px';
                
                productItem.innerHTML = `
                    <img src="${product.images[0] || '/images/placeholder.jpg'}" alt="${product.name}" 
                        style="width: 60px; height: 60px; object-fit: cover; margin-right: 10px;">
                    <div style="flex: 1;">
                        <h4>${product.name}</h4>
                        <p>Price: $${product.price.toFixed(2)}</p>
                        <p>Stock: ${product.quantity}</p>
                    </div>
                    <div>
                        <button class="delete-product-btn btn-primary" data-id="${product.id}" 
                            style="background-color: #e74c3c;">Delete</button>
                    </div>
                `;
                
                productsList.appendChild(productItem);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-product-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteProduct(btn.dataset.id));
            });
        }
        
        showModal();
    } catch (error) {
        console.error('Error fetching seller products:', error);
        showToast('Failed to load your products', 'error');
    } finally {
        hideLoading();
    }
}

// Add this function to handle product deletion
async function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        showLoading();
        
        try {
            const response = await fetch(`/api/products/${productId}`, {
                method: 'DELETE'
            });
            
            if (!response.ok) {
                const data = await response.json();
                throw new Error(data.message || 'Failed to delete product');
            }
            
            showToast('Product deleted successfully', 'success');
            closeModal();
            
            // Refresh products if currently on products section
            if (activeSection === 'products-section') {
                fetchProducts();
            }
        } catch (error) {
            console.error('Error deleting product:', error);
            showToast(error.message || 'Failed to delete product', 'error');
        } finally {
            hideLoading();
        }
    }
}

function logout() {
    currentUser = null;
    sessionStorage.removeItem('user');
    updateAuthUI();
    closeModal();
    showToast('Logged out successfully', 'success');
    navigateTo('products-section');
}

// Sell Product
async function handleProductSubmit(e) {
    e.preventDefault();
    
    if (!currentUser) {
        showToast('Please login to sell products', 'warning');
        navigateTo('auth-section');
        return;
    }
    
    const productData = {
        name: document.getElementById('product-name').value,
        description: document.getElementById('product-description').value,
        category: document.getElementById('product-category').value,
        condition: document.getElementById('product-condition').value,
        price: parseFloat(document.getElementById('product-price').value),
        quantity: parseInt(document.getElementById('product-quantity').value),
        seller: {
            id: currentUser.id,
            name: currentUser.name
        }
    };
    
    if (!productData.name || !productData.description || !productData.category || !productData.condition || isNaN(productData.price)) {
        showToast('Please fill in all required fields', 'warning');
        return;
    }
    
    // Handle image uploads
    const imageInput = document.getElementById('product-image');
    if (imageInput.files.length > 0) {
        const formData = new FormData();
        
        // Add product data to FormData
        for (const key in productData) {
            if (key === 'seller') {
                formData.append(key, JSON.stringify(productData[key]));
            } else {
                formData.append(key, productData[key]);
            }
        }
        
        // Add images to FormData
        for (let i = 0; i < imageInput.files.length; i++) {
            formData.append('images', imageInput.files[i]);
        }
        
        showLoading();
        
        try {
            const response = await fetch('/api/products', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || 'Failed to add product');
            }
            
            // Reset form
            document.getElementById('sell-form').reset();
            document.getElementById('image-preview').innerHTML = '';
            
            showToast('Product added successfully', 'success');
            navigateTo('products-section');
            fetchProducts();
        } catch (error) {
            console.error('Error adding product:', error);
            showToast(error.message || 'Failed to add product', 'error');
        } finally {
            hideLoading();
        }
    } else {
        showToast('Please add at least one product image', 'warning');
    }
}

function handleImagePreview(e) {
    const files = e.target.files;
    const preview = document.getElementById('image-preview');
    preview.innerHTML = '';
    
    if (files) {
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = document.createElement('img');
                img.src = event.target.result;
                img.className = 'preview-image';
                preview.appendChild(img);
            }
            reader.readAsDataURL(file);
        });
    }
}

// Cart Management
function addToCart(product, quantity = 1) {
    // Check if product already in cart
    const existingItem = cart.find(item => item.id === product.id);
    
    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        cart.push({
            id: product.id,
            name: product.name,
            price: product.price,
            image: product.images[0],
            quantity
        });
    }
    
    // Save cart to localStorage
    saveCart();
    
    // Update cart count
    updateCartCount();
    
    showToast(`${product.name} added to cart`, 'success');
}

function updateCartCount() {
    const cartCount = document.getElementById('cart-count');
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    cartCount.textContent = totalItems;
}

function renderCart() {
    const cartItems = document.getElementById('cart-items');
    const cartTotalAmount = document.getElementById('cart-total-amount');
    
    if (cart.length === 0) {
        cartItems.innerHTML = '<p>Your cart is empty.</p>';
        cartTotalAmount.textContent = '$0.00';
        return;
    }
    
    cartItems.innerHTML = '';
    let total = 0;
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
            <img src="${item.image || '/images/placeholder.jpg'}" alt="${item.name}" class="cart-item-image">
            <div class="cart-item-details">
                <h3>${item.name}</h3>
                <p>$${item.price.toFixed(2)} × ${item.quantity}</p>
                <p><strong>Total: $${itemTotal.toFixed(2)}</strong></p>
            </div>
            <div class="cart-item-actions">
                <button class="btn-primary decrease-quantity" data-id="${item.id}">-</button>
                <span>${item.quantity}</span>
                <button class="btn-primary increase-quantity" data-id="${item.id}">+</button>
                <button class="btn-primary remove-item" data-id="${item.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        
        cartItems.appendChild(cartItem);
    });
    
    // Update total
    cartTotalAmount.textContent = `$${total.toFixed(2)}`;
    
    // Add event listeners for cart actions
    document.querySelectorAll('.decrease-quantity').forEach(button => {
        button.addEventListener('click', () => {
            updateCartItemQuantity(button.dataset.id, -1);
        });
    });
    
    document.querySelectorAll('.increase-quantity').forEach(button => {
        button.addEventListener('click', () => {
            updateCartItemQuantity(button.dataset.id, 1);
        });
    });
    
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', () => {
            removeFromCart(button.dataset.id);
        });
    });
}

function updateCartItemQuantity(itemId, change) {
    const item = cart.find(item => item.id === itemId);
    
    if (item) {
        item.quantity += change;
        
        if (item.quantity <= 0) {
            removeFromCart(itemId);
        } else {
            saveCart();
            renderCart();
            updateCartCount();
        }
    }
}

function removeFromCart(itemId) {
    cart = cart.filter(item => item.id !== itemId);
    saveCart();
    renderCart();
    updateCartCount();
    showToast('Item removed from cart', 'success');
}

function saveCart() {
    localStorage.setItem('cart', JSON.stringify(cart));
}

function loadCart() {
    const savedCart = localStorage.getItem('cart');
    if (savedCart) {
        cart = JSON.parse(savedCart);
        renderCart();
        updateCartCount();
    }
    
    // Load user session
    const savedUser = sessionStorage.getItem('user');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateAuthUI();
    }
}

// Checkout
function updateOrderSummary() {
    const orderItems = document.getElementById('order-items');
    const orderSubtotal = document.getElementById('order-subtotal');
    const orderShipping = document.getElementById('order-shipping');
    const orderTax = document.getElementById('order-tax');
    const orderTotal = document.getElementById('order-total');
    
    orderItems.innerHTML = '';
    
    let subtotal = 0;
    
    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        
        const orderItem = document.createElement('div');
        orderItem.className = 'order-item';
        orderItem.innerHTML = `
            <img src="${item.image || '/images/placeholder.jpg'}" alt="${item.name}" class="order-item-image">
            <div class="order-item-details">
                <h4>${item.name}</h4>
                <p>$${item.price.toFixed(2)} × ${item.quantity}</p>
                <p><strong>$${itemTotal.toFixed(2)}</strong></p>
            </div>
        `;
        
        orderItems.appendChild(orderItem);
    });
    
    // Calculate additional costs
    const shipping = subtotal > 0 ? 15 : 0;
    const tax = subtotal * 0.08; // 8% tax
    const total = subtotal + shipping + tax;
    
    // Update summary
    orderSubtotal.textContent = `$${subtotal.toFixed(2)}`;
    orderShipping.textContent = `$${shipping.toFixed(2)}`;
    orderTax.textContent = `$${tax.toFixed(2)}`;
    orderTotal.textContent = `$${total.toFixed(2)}`;
}

async function handleCheckout(e) {
    e.preventDefault();
    
    if (cart.length === 0) {
        showToast('Your cart is empty', 'warning');
        return;
    }
    
    // Collect shipping info
    const shippingInfo = {
        name: document.getElementById('shipping-name').value,
        address: document.getElementById('shipping-address').value,
        city: document.getElementById('shipping-city').value,
        zip: document.getElementById('shipping-zip').value,
        country: document.getElementById('shipping-country').value,
        phone: document.getElementById('shipping-phone').value
    };
    
    // Check if all fields are filled
    if (!shippingInfo.name || !shippingInfo.address || !shippingInfo.city || 
        !shippingInfo.zip || !shippingInfo.country || !shippingInfo.phone) {
        showToast('Please fill in all shipping information', 'warning');
        return;
    }
    
    // Get selected payment method
    const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
    
    // Validate payment details based on method
    if (paymentMethod === 'credit-card') {
        const cardNumber = document.getElementById('card-number').value;
        const cardExpiry = document.getElementById('card-expiry').value;
        const cardCvv = document.getElementById('card-cvv').value;
        const cardName = document.getElementById('card-name').value;
        
        if (!cardNumber || !cardExpiry || !cardCvv || !cardName) {
            showToast('Please fill in all card details', 'warning');
            return;
        }
    } else if (paymentMethod === 'upi') {
        const upiId = document.getElementById('upi-id').value;
        
        if (!upiId) {
            showToast('Please enter your UPI ID', 'warning');
            return;
        }
    }
    
    showLoading();
    
    try {
        // Calculate order totals
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        const shipping = 15;
        const tax = subtotal * 0.08;
        const total = subtotal + shipping + tax;
        
        // Create order object
        const order = {
            user: currentUser ? currentUser.id : 'guest',
            items: cart,
            shipping: shippingInfo,
            payment: {
                method: paymentMethod,
                total: total,
                subtotal: subtotal,
                tax: tax,
                shipping: shipping
            },
            status: 'processing',
            date: new Date().toISOString()
        };
        
        const response = await fetch('/api/orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(order)
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.message || 'Failed to place order');
        }
        
        // Clear cart after successful order
        cart = [];
        saveCart();
        updateCartCount();
        
        // Show success and navigate to order tracking
        showToast('Order placed successfully!', 'success');
        showOrderConfirmation(data.order);
    } catch (error) {
        console.error('Checkout error:', error);
        showToast(error.message || 'Failed to place order', 'error');
    } finally {
        hideLoading();
    }
}

function showOrderConfirmation(order) {
    const modalBody = document.getElementById('modal-body');
    modalBody.innerHTML = `
        <h2>Order Confirmation</h2>
        <p>Thank you for your order!</p>
        <p>Order ID: ${order.id}</p>
        <p>Total: $${order.payment.total.toFixed(2)}</p>
        <p>Status: ${order.status}</p>
        <p>We've sent a confirmation email to your address.</p>
        <hr>
        <button id="track-order-btn" class="btn-primary">Track Order</button>
    `;
    
    document.getElementById('track-order-btn').addEventListener('click', () => {
        closeModal();
        trackOrder(order.id);
    });
    
    showModal();
}


async function fetchOrders(status = 'active') {
    if (!currentUser) {
        showToast('Please login to view orders', 'warning');
        navigateTo('auth-section');
        return;
    }
    
    showLoading();
    
    try {
        const response = await fetch(`/api/orders?user=${currentUser.id}&status=${status}`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch orders');
        }
        
        const orders = await response.json();
        renderOrders(orders, status);
    } catch (error) {
        console.error('Error fetching orders:', error);
        showToast('Failed to load orders', 'error');
    } finally {
        hideLoading();
    }
}

function renderOrders(orders, status) {
    const ordersList = document.getElementById('orders-list');
    
    if (orders.length === 0) {
        ordersList.innerHTML = `<p>No ${status} orders found.</p>`;
        return;
    }
    
    ordersList.innerHTML = '';
    
    orders.forEach(order => {
        const orderCard = document.createElement('div');
        orderCard.className = 'order-card';
        orderCard.innerHTML = `
            <div class="order-header">
                <div>
                    <h3>Order #${order.id}</h3>
                    <p>Date: ${new Date(order.date).toLocaleDateString()}</p>
                </div>
                <div>
                    <span class="status ${order.status.toLowerCase()}">${order.status}</span>
                    <p>Total: $${order.payment.total.toFixed(2)}</p>
                </div>
            </div>
            <div class="order-products">
                ${order.items.map(item => `
                    <div class="order-product">
                        <img src="${item.image || '/images/placeholder.jpg'}" alt="${item.name}" class="order-product-image">
                        <div>
                            <p>${item.name}</p>
                            <p>$${item.price.toFixed(2)} × ${item.quantity}</p>
                        </div>
                    </div>
                `).join('')}
            </div>
            <div class="order-footer">
                <button class="btn-primary track-order-btn" data-id="${order.id}">Track Order</button>
                ${order.status === 'delivered' ? 
                    `<button class="btn-primary leave-review-btn" data-id="${order.id}">Leave Review</button>` : ''}
            </div>
        `;
        
        ordersList.appendChild(orderCard);
    });
    
    // Add event listeners
    document.querySelectorAll('.track-order-btn').forEach(btn => {
        btn.addEventListener('click', () => trackOrder(btn.dataset.id));
    });
    
    document.querySelectorAll('.leave-review-btn').forEach(btn => {
        btn.addEventListener('click', () => showReviewForm(btn.dataset.id));
    });
}

async function trackOrder(orderId) {
    showLoading();
    
    try {
        const response = await fetch(`/api/orders/${orderId}/track`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch order tracking information');
        }
        
        const trackingInfo = await response.json();
        renderOrderTracking(trackingInfo);
        navigateTo('order-tracking-section');
    } catch (error) {
        console.error('Error tracking order:', error);
        showToast('Failed to retrieve tracking information', 'error');
    } finally {
        hideLoading();
    }
}

function renderOrderTracking(tracking) {
    const orderDetails = document.getElementById('tracking-order-details');
    const trackingTimeline = document.getElementById('tracking-timeline');
    const shippingDetails = document.getElementById('shipping-details');
    
    // Order details
    orderDetails.innerHTML = `
        <h3>Order #${tracking.orderId}</h3>
        <p>Date: ${new Date(tracking.date).toLocaleDateString()}</p>
        <p>Status: ${tracking.status}</p>
        <p>Estimated Delivery: ${new Date(tracking.estimatedDelivery).toLocaleDateString()}</p>
    `;
    
    // Tracking timeline
    trackingTimeline.innerHTML = '';
    
    const steps = [
        { id: 'order-placed', name: 'Order Placed', date: tracking.date },
        { id: 'processing', name: 'Processing', date: tracking.processingDate },
        { id: 'shipped', name: 'Shipped', date: tracking.shippedDate },
        { id: 'out-for-delivery', name: 'Out for Delivery', date: tracking.outForDeliveryDate },
        { id: 'delivered', name: 'Delivered', date: tracking.deliveredDate }
    ];
    
    const currentStepIndex = steps.findIndex(step => step.id === tracking.currentStep);
    
    steps.forEach((step, index) => {
        const stepElement = document.createElement('div');
        stepElement.className = 'tracking-step';
        
        let stepStatus = 'pending';
        if (index < currentStepIndex) {
            stepStatus = 'completed';
        } else if (index === currentStepIndex) {
            stepStatus = 'current';
        }
        
        stepElement.innerHTML = `
            <div class="step-icon ${stepStatus}">
                <i class="fas ${getStepIcon(step.id)}"></i>
            </div>
            <div class="step-info">
                <h4>${step.name}</h4>
                ${step.date ? `<p class="step-date">${new Date(step.date).toLocaleString()}</p>` : 
                     '<p class="step-date">Pending</p>'}
                ${getStepDescription(step.id)}
            </div>
        `;
        
        trackingTimeline.appendChild(stepElement);
    });
    
    // Shipping details
    shippingDetails.innerHTML = `
        <h3>Shipping Details</h3>
        <p><strong>Shipping Address:</strong></p>
        <p>${tracking.shipping.name}</p>
        <p>${tracking.shipping.address}</p>
        <p>${tracking.shipping.city}, ${tracking.shipping.zip}</p>
        <p>${tracking.shipping.country}</p>
        <p><strong>Contact:</strong> ${tracking.shipping.phone}</p>
        ${tracking.trackingNumber ? `<p><strong>Tracking Number:</strong> ${tracking.trackingNumber}</p>` : ''}
        ${tracking.carrier ? `<p><strong>Carrier:</strong> ${tracking.carrier}</p>` : ''}
    `;
}

function getStepIcon(stepId) {
    switch (stepId) {
        case 'order-placed': return 'fa-check-circle';
        case 'processing': return 'fa-cog';
        case 'shipped': return 'fa-truck';
        case 'out-for-delivery': return 'fa-truck-loading';
        case 'delivered': return 'fa-box-open';
        default: return 'fa-circle';
    }
}

function getStepDescription(stepId) {
    switch (stepId) {
        case 'order-placed': return '<p>Your order has been received and is being prepared.</p>';
        case 'processing': return '<p>Your order is being processed and packaged.</p>';
        case 'shipped': return '<p>Your order has been shipped and is on its way.</p>';
        case 'out-for-delivery': return '<p>Your order is out for delivery today.</p>';
        case 'delivered': return '<p>Your order has been delivered successfully.</p>';
        default: return '';
    }
}

function showReviewForm(orderId) {
    const modalBody = document.getElementById('modal-body');
    modalBody.innerHTML = `
        <h2>Leave a Review</h2>
        <p>Share your experience with this purchase:</p>
        <form id="review-form">
            <input type="hidden" id="review-order-id" value="${orderId}">
            <div class="form-group">
                <label>Rating</label>
                <div class="rating-stars">
                    <span class="star" data-rating="1">★</span>
                    <span class="star" data-rating="2">★</span>
                    <span class="star" data-rating="3">★</span>
                    <span class="star" data-rating="4">★</span>
                    <span class="star" data-rating="5">★</span>
                </div>
                <input type="hidden" id="review-rating" value="0">
            </div>
            <div class="form-group">
                <label for="review-title">Title</label>
                <input type="text" id="review-title" required>
            </div>
            <div class="form-group">
                <label for="review-comment">Comment</label>
                <textarea id="review-comment" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn-primary">Submit Review</button>
        </form>
    `;
    
    // Setup star rating
    let selectedRating = 0;
    const stars = document.querySelectorAll('.star');
    stars.forEach(star => {
        star.addEventListener('click', () => {
            selectedRating = parseInt(star.dataset.rating);
            document.getElementById('review-rating').value = selectedRating;
            updateStars(selectedRating);
        });
        
        star.addEventListener('mouseover', () => {
            updateStars(parseInt(star.dataset.rating));
        });
        
        star.addEventListener('mouseout', () => {
            updateStars(selectedRating);
        });
    });
    
    function updateStars(rating) {
        stars.forEach(star => {
            if (parseInt(star.dataset.rating) <= rating) {
                star.classList.add('selected');
            } else {
                star.classList.remove('selected');
            }
        });
    }
    
    // Setup form submission
    document.getElementById('review-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const rating = document.getElementById('review-rating').value;
        if (rating === '0') {
            showToast('Please select a rating', 'warning');
            return;
        }
        
        const review = {
            orderId: document.getElementById('review-order-id').value,
            userId: currentUser.id,
            rating: parseInt(rating),
            title: document.getElementById('review-title').value,
            comment: document.getElementById('review-comment').value,
            date: new Date().toISOString()
        };
        
        showLoading();
        
        try {
            const response = await fetch('/api/reviews', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(review)
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || 'Failed to submit review');
            }
            
            closeModal();
            showToast('Review submitted successfully', 'success');
            fetchOrders('completed');
        } catch (error) {
            console.error('Error submitting review:', error);
            showToast(error.message || 'Failed to submit review', 'error');
        } finally {
            hideLoading();
        }
    });
    
    showModal();
}

// Utility Functions
function showLoading() {
    document.getElementById('loading-spinner').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loading-spinner').style.display = 'none';
}

function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    toastContainer.appendChild(toast);
    
    // Force reflow to trigger animation
    toast.offsetHeight;
    toast.style.opacity = '1';
    
    // Remove toast after 3 seconds
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}

function showModal() {
    document.getElementById('modal').style.display = 'block';
}

function closeModal() {
    document.getElementById('modal').style.display = 'none';
}

// Update the price range slider event listeners at the end of the file:
document.getElementById('min-price').addEventListener('input', (e) => {
    document.getElementById('min-price-value').textContent = `₹${e.target.value}`;
});

document.getElementById('max-price').addEventListener('input', (e) => {
    document.getElementById('max-price-value').textContent = `₹${e.target.value}`;
});
</script>
</body>
</html>